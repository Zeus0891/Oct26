# Estimate Module - API Requirements

## Overview

This document outlines the API endpoints required for the Estimate module to function in production.

## Required API Endpoints

### 1. Get All Estimates

```
GET /api/v1/estimates
```

**Response:**

```json
{
  "data": [
    {
      "id": "string",
      "globalId": "string",
      "estimateNumber": "string",
      "customerId": "string",
      "projectId": "string?",
      "title": "string",
      "description": "string?",
      "currency": "USD|EUR|GBP|CAD|AUD|JPY|CHF|CNY|INR|MXN",
      "subtotal": "number",
      "totalTax": "number",
      "totalDiscount": "number",
      "grandTotal": "number",
      "status": "DRAFT|SENT|VIEWED|CLIENT_APPROVED|CLIENT_DECLINED|APPROVED|DECLINED|CONVERTED|EXPIRED|CANCELLED",
      "validUntil": "string (ISO date)?",
      "createdAt": "string (ISO date)",
      "updatedAt": "string (ISO date)",
      "version": "number",
      "notes": "string?",
      "lineItems": [
        {
          "id": "string",
          "itemNumber": "number",
          "description": "string",
          "quantity": "number",
          "unitPrice": "number",
          "unitOfMeasure": "string?",
          "notes": "string?",
          "costCategoryId": "string?",
          "costCodeId": "string?"
        }
      ]
    }
  ],
  "pagination": {
    "page": "number",
    "limit": "number",
    "total": "number",
    "pages": "number"
  }
}
```

### 2. Get Estimate Statistics

```
GET /api/estimates/stats
```

**Response:**

```json
{
  "data": {
    "totalEstimates": "number",
    "pendingEstimates": "number",
    "approvedEstimates": "number",
    "totalValue": "number",
    "averageValue": "number",
    "conversionRate": "number"
  }
}
```

### 3. Get Single Estimate

```
GET /api/estimates/:id
```

**Response:**

```json
{
  "data": {
    // Same structure as estimate object above
  }
}
```

### 4. Create New Estimate

```
POST /api/v1/estimates
```

**Request Body:**

```json
{
  "estimateNumber": "string?",
  "customerId": "string",
  "projectId": "string?",
  "title": "string",
  "description": "string?",
  "currency": "USD|EUR|GBP|CAD|AUD|JPY|CHF|CNY|INR|MXN",
  "validUntil": "string (ISO date)?",
  "notes": "string?",
  "projectTitle": "string",
  "description": "string?",
  "items": [
    {
      "description": "string",
      "quantity": "number",
      "unitPrice": "number",
      "category": "string"
    }
  ],
  "taxRate": "number",
  "discountRate": "number",
  "validUntil": "string (ISO date)",
  "notes": "string?"
}
```

**Response:**

```json
{
  "data": {
    // Complete estimate object with generated fields
  }
}
```

### 5. Update Estimate

```
PUT /api/estimates/:id
```

**Request Body:**

```json
{
  // Same structure as create request
}
```

**Response:**

```json
{
  "data": {
    // Updated estimate object
  }
}
```

### 6. Delete Estimate

```
DELETE /api/estimates/:id
```

**Response:**

```json
{
  "message": "Estimate deleted successfully"
}
```

### 7. Send Estimate to Client

```
POST /api/estimates/:id/send
```

**Response:**

```json
{
  "message": "Estimate sent successfully",
  "data": {
    // Updated estimate with status 'sent'
  }
}
```

### 8. Approve Estimate

```
POST /api/estimates/:id/approve
```

**Response:**

```json
{
  "data": {
    // Updated estimate with status 'approved'
  }
}
```

### 9. Reject Estimate

```
POST /api/estimates/:id/reject
```

**Request Body:**

```json
{
  "reason": "string?"
}
```

**Response:**

```json
{
  "data": {
    // Updated estimate with status 'rejected'
  }
}
```

### 10. Generate PDF

```
GET /api/estimates/:id/pdf
```

**Response:** Binary PDF file

### 11. Duplicate Estimate

```
POST /api/estimates/:id/duplicate
```

**Response:**

```json
{
  "data": {
    // New estimate object (copy of original)
  }
}
```

## Error Handling

All endpoints should return appropriate HTTP status codes and error messages:

```json
{
  "error": {
    "message": "string",
    "code": "string",
    "details": "object?"
  }
}
```

## Status Codes

- 200: Success
- 201: Created
- 400: Bad Request
- 401: Unauthorized
- 403: Forbidden
- 404: Not Found
- 422: Validation Error
- 500: Internal Server Error

## Authentication

All endpoints require authentication. Include appropriate authentication headers in requests.

## Notes

- All date fields should be in ISO 8601 format
- Monetary values should be in the smallest currency unit (e.g., cents)
- The frontend handles all calculations for totals, taxes, and discounts
- Estimate numbers should be auto-generated by the backend
- Status transitions should be validated on the backend
